<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カスタムタイマー</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f7f6;
            color: #333;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-align: center;
        }

        /* --- タイマーセクション共通スタイル --- */
        .timer-section {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 40px;
            width: 100%;
            max-width: 500px; /* 通常のセクションの最大幅 */
            text-align: center;
        }

        .timer-section h2 {
            color: #34495e;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        .timer-info {
            font-size: 1.1em;
            margin-bottom: 25px;
            line-height: 1.6;
            color: #555;
        }

        .timer-controls button {
            background-color: #2ecc71; /* Green for start */
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 1.4em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 10px;
            min-width: 120px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .timer-controls button:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        .timer-controls button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .timer-controls button.reset {
            background-color: #008CBA; /* Blue for reset */
        }

        .timer-controls button.reset:hover {
            background-color: #007bb5;
        }

        .current-status {
            margin-top: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: #3498db;
            min-height: 1.5em; /* Layout stability */
        }

        .next-beep-time {
            margin-top: 15px;
            font-size: 1.1em;
            color: #7f8c8d; /* Grayish blue */
            min-height: 1.3em;
        }

        /* --- 機能1の複数タイマー用コンテナ --- */
        .feature1-container {
            display: flex;
            flex-wrap: wrap; /* 画面幅が狭い場合に折り返す */
            justify-content: center;
            gap: 20px; /* タイマー間のスペース */
            margin-bottom: 40px;
            width: 100%;
            max-width: 1100px; /* 複数のタイマーを横並びにするための最大幅 */
        }

        /* 機能1個別のタイマーセクションのスタイル */
        .feature1-container .timer-section {
            flex: 1 1 calc(33.333% - 20px); /* 3列表示の基本 */
            min-width: 280px; /* 狭い画面での最小幅 */
            margin-bottom: 0; /* 親コンテナで管理 */
            padding: 20px; /* 少し小さめに */
        }

        .feature1-container .timer-section h2 {
            font-size: 1.4em; /* 小さめのタイトル */
            margin-bottom: 10px;
            border-bottom: none; /* 下線を削除 */
            padding-bottom: 0;
        }

        .feature1-container .timer-section .timer-info {
            display: none; /* 個別の説明は非表示 */
        }

        .feature1-container .timer-section .timer-controls button {
            padding: 10px 20px;
            font-size: 1.1em;
            margin: 5px;
            min-width: 100px;
        }

        /* --- レスポンシブ調整 --- */
        @media (max-width: 1000px) {
            .feature1-container .timer-section {
                flex: 1 1 calc(50% - 20px); /* 2列表示 */
            }
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2em;
            }
            .timer-section {
                padding: 20px;
            }
            .timer-section h2 {
                font-size: 1.5em;
            }
            .timer-controls button {
                padding: 12px 25px;
                font-size: 1.2em;
                margin: 8px;
            }
            /* スマホでは1列表示 */
            .feature1-container .timer-section {
                flex: 1 1 100%; /* 1列表示 */
            }
        }
    </style>
</head>
<body>
    <h1>カスタムタイマー</h1>

    <div class="timer-section">
        <h2>機能1: 固定2回</h2>
        <p class="timer-info">ボタンを押してから **105秒後** と **110秒後** に音が鳴ります。</p>
    </div>

    <div class="feature1-container">
        <div class="timer-section" id="timerSection1">
            <h2>タイマー 1-1</h2>
            <div class="timer-controls">
                <button onclick="startTimer1(1)">スタート</button>
                <button class="reset" onclick="resetTimer(1)">リセット</button>
            </div>
            <div class="current-status" id="status1"></div>
            <div class="next-beep-time" id="nextBeep1"></div>
        </div>

        <div class="timer-section" id="timerSection2">
            <h2>タイマー 1-2</h2>
            <div class="timer-controls">
                <button onclick="startTimer1(2)">スタート</button>
                <button class="reset" onclick="resetTimer(2)">リセット</button>
            </div>
            <div class="current-status" id="status2"></div>
            <div class="next-beep-time" id="nextBeep2"></div>
        </div>

        <div class="timer-section" id="timerSection3">
            <h2>タイマー 1-3</h2>
            <div class="timer-controls">
                <button onclick="startTimer1(3)">スタート</button>
                <button class="reset" onclick="resetTimer(3)">リセット</button>
            </div>
            <div class="current-status" id="status3"></div>
            <div class="next-beep-time" id="nextBeep3"></div>
        </div>

        <div class="timer-section" id="timerSection4">
            <h2>タイマー 1-4</h2>
            <div class="timer-controls">
                <button onclick="startTimer1(4)">スタート</button>
                <button class="reset" onclick="resetTimer(4)">リセット</button>
            </div>
            <div class="current-status" id="status4"></div>
            <div class="next-beep-time" id="nextBeep4"></div>
        </div>
    </div> ---

    <div class="timer-section" id="timerSection6">
        <h2>機能2: 繰り返し（10秒/15秒）</h2>
        <p class="timer-info">ボタンを押してから **105秒後** と **110秒後** に音が鳴ります。<br>その後、**10秒後** と **15秒後** に音が鳴るサイクルを繰り返します。</p>
        <div class="timer-controls">
            <button onclick="startTimer2(6)">スタート</button>
            <button class="reset" onclick="resetTimer(6)">リセット</button>
        </div>
        <div class="current-status" id="status6"></div>
        <div class="next-beep-time" id="nextBeep6"></div>
    </div>

    <div class="timer-section" id="timerSection7">
        <h2>機能3: 繰り返し（7.6秒/12.6秒）</h2>
        <p class="timer-info">ボタンを押してから **105秒後** と **110秒後** に音が鳴ります。<br>その後、**7.6秒後** と **12.6秒後** に音が鳴るサイクルを繰り返します。</p>
        <div class="timer-controls">
            <button onclick="startTimer3(7)">スタート</button>
            <button class="reset" onclick="resetTimer(7)">リセット</button>
        </div>
        <div class="current-status" id="status7"></div>
        <div class="next-beep-time" id="nextBeep7"></div>
    </div>

    <script>
        // 各タイマーの状態を管理するオブジェクト
        // 機能1はID 1～4、機能2はID 6、機能3はID 7とする
        const timers = {
            1: { timeouts: [], intervals: [], startTime: null, nextBeepTimes: [], updateInterval: null, statusElement: null, nextBeepElement: null, sectionElement: null },
            2: { timeouts: [], intervals: [], startTime: null, nextBeepTimes: [], updateInterval: null, statusElement: null, nextBeepElement: null, sectionElement: null },
            3: { timeouts: [], intervals: [], startTime: null, nextBeepTimes: [], updateInterval: null, statusElement: null, nextBeepElement: null, sectionElement: null },
            4: { timeouts: [], intervals: [], startTime: null, nextBeepTimes: [], updateInterval: null, statusElement: null, nextBeepElement: null, sectionElement: null },
            // タイマー1-5を削除したため、5の行は不要になります
            6: { timeouts: [], intervals: [], startTime: null, nextBeepTimes: [], updateInterval: null, statusElement: null, nextBeepElement: null, sectionElement: null },
            7: { timeouts: [], intervals: [], startTime: null, nextBeepTimes: [], updateInterval: null, statusElement: null, nextBeepElement: null, sectionElement: null }
        };

        function playBeep() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                console.error("音声の再生に失敗しました:", e);
            }
        }

        function resetTimer(timerId) {
            const timer = timers[timerId];
            if (!timer) return;

            timer.timeouts.forEach(timeoutId => clearTimeout(timeoutId));
            timer.intervals.forEach(intervalId => clearInterval(intervalId));
            if (timer.updateInterval) {
                clearInterval(timer.updateInterval);
            }

            timer.timeouts = [];
            timer.intervals = [];
            timer.startTime = null;
            timer.nextBeepTimes = [];
            timer.updateInterval = null;

            updateStatus(timer.statusElement, '待機中', '#7f8c8d');
            updateNextBeepTime(timer.nextBeepElement, '');
            console.log(`機能${timerId}のタイマーがリセットされました。`);
        }

        function updateStatus(statusElement, message, color = '#3498db') {
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.style.color = color;
            }
        }

        function updateNextBeepTime(element, nextBeepTimestamp) {
            if (!element) return;

            if (nextBeepTimestamp === '') {
                element.textContent = '';
                return;
            }

            const now = Date.now();
            const remainingMs = nextBeepTimestamp - now;

            if (remainingMs <= 0) {
                element.textContent = '次の音: すぐ';
            } else {
                const remainingSec = Math.ceil(remainingMs / 1000);
                element.textContent = `次の音まで: ${remainingSec}秒`;
            }
        }

        // --- 機能1 (共通ロジック): 固定2回 ---
        function startTimer1(timerId) {
            const timer = timers[timerId];
            timer.statusElement = document.getElementById(`status${timerId}`);
            timer.nextBeepElement = document.getElementById(`nextBeep${timerId}`);
            timer.sectionElement = document.getElementById(`timerSection${timerId}`);

            resetTimer(timerId);

            timer.startTime = Date.now();
            updateStatus(timer.statusElement, 'タイマーを開始しました。');

            const beep1Time = timer.startTime + (105 * 1000);
            const beep2Time = timer.startTime + (110 * 1000);
            timer.nextBeepTimes = [beep1Time, beep2Time].sort((a, b) => a - b);

            const timeout1 = setTimeout(() => {
                playBeep();
                updateStatus(timer.statusElement, '105秒経過！');
                console.log(`機能${timerId}: 105秒後に音が鳴りました。`);
                timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());
            }, 105 * 1000);

            const timeout2 = setTimeout(() => {
                playBeep();
                updateStatus(timer.statusElement, '110秒経過！完了。', '#2ecc71');
                console.log(`機能${timerId}: 110秒後に音が鳴りました。`);
                timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());
                if (timer.updateInterval) {
                     clearInterval(timer.updateInterval);
                     timer.updateInterval = null;
                }
            }, 110 * 1000);

            timer.timeouts.push(timeout1, timeout2);

            timer.updateInterval = setInterval(() => {
                const nextBeep = timer.nextBeepTimes[0];
                updateNextBeepTime(timer.nextBeepElement, nextBeep || '');
                if (timer.nextBeepTimes.length === 0 && timer.timeouts.every(t => !t)) {
                    clearInterval(timer.updateInterval);
                    timer.updateInterval = null;
                    updateNextBeepTime(timer.nextBeepElement, '');
                }
            }, 1000);
        }

        function startTimer2(timerId) {
            const timer = timers[timerId];
            timer.statusElement = document.getElementById(`status${timerId}`);
            timer.nextBeepElement = document.getElementById(`nextBeep${timerId}`);
            timer.sectionElement = document.getElementById(`timerSection${timerId}`);

            resetTimer(timerId);

            timer.startTime = Date.now();
            updateStatus(timer.statusElement, 'タイマーを開始しました。');

            const initialBeep1Time = timer.startTime + (105 * 1000);
            const initialBeep2Time = timer.startTime + (110 * 1000);
            timer.nextBeepTimes = [initialBeep1Time, initialBeep2Time].sort((a, b) => a - b);

            const playCycleBeeps = () => {
                const currentCycleStartTime = Date.now();
                const cycleBeep1Time = currentCycleStartTime + (10 * 1000);
                const cycleBeep2Time = currentCycleStartTime + (15 * 1000);

                timer.nextBeepTimes.push(cycleBeep1Time, cycleBeep2Time);
                timer.nextBeepTimes.sort((a, b) => a - b);

                const cycleTimeout1 = setTimeout(() => {
                    playBeep();
                    updateStatus(timer.statusElement, `音1鳴動 (サイクル開始から10秒)`, '#f39c12');
                    console.log(`機能${timerId}: サイクルから10秒後に音が鳴りました。`);
                    timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());
                }, 10 * 1000);

                const cycleTimeout2 = setTimeout(() => {
                    playBeep();
                    updateStatus(timer.statusElement, `音2鳴動 (サイクル開始から15秒)`, '#f39c12');
                    console.log(`機能${timerId}: サイクルから15秒後に音が鳴りました。`);
                    timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());
                }, 15 * 1000);
                timer.timeouts.push(cycleTimeout1, cycleTimeout2);
            };

            const initialTimeout1 = setTimeout(() => {
                playBeep();
                updateStatus(timer.statusElement, '105秒経過！', '#3498db');
                console.log(`機能${timerId}: 105秒後に音が鳴りました。`);
                timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());
            }, 105 * 1000);

            const initialTimeout2 = setTimeout(() => {
                playBeep();
                updateStatus(timer.statusElement, '110秒経過！繰り返し開始。', '#3498db');
                console.log(`機能${timerId}: 110秒後に音が鳴りました。初回完了。`);
                timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());

                playCycleBeeps();

                const intervalId = setInterval(() => {
                    playCycleBeeps();
                }, 15 * 1000);
                timer.intervals.push(intervalId);

            }, 110 * 1000);

            timer.timeouts.push(initialTimeout1, initialTimeout2);

            timer.updateInterval = setInterval(() => {
                const nextBeep = timer.nextBeepTimes[0];
                updateNextBeepTime(timer.nextBeepElement, nextBeep || '');
            }, 1000);
        }

        function startTimer3(timerId) {
            const timer = timers[timerId];
            timer.statusElement = document.getElementById(`status${timerId}`);
            timer.nextBeepElement = document.getElementById(`nextBeep${timerId}`);
            timer.sectionElement = document.getElementById(`timerSection${timerId}`);

            resetTimer(timerId);

            timer.startTime = Date.now();
            updateStatus(timer.statusElement, 'タイマーを開始しました。');

            const initialBeep1Time = timer.startTime + (105 * 1000);
            const initialBeep2Time = timer.startTime + (110 * 1000);
            timer.nextBeepTimes = [initialBeep1Time, initialBeep2Time].sort((a, b) => a - b);

            const playCycleBeeps = () => {
                const currentCycleStartTime = Date.now();
                const cycleBeep1Time = currentCycleStartTime + (7.6 * 1000);
                const cycleBeep2Time = currentCycleStartTime + (12.6 * 1000);

                timer.nextBeepTimes.push(cycleBeep1Time, cycleBeep2Time);
                timer.nextBeepTimes.sort((a, b) => a - b);

                const cycleTimeout1 = setTimeout(() => {
                    playBeep();
                    updateStatus(timer.statusElement, `音1鳴動 (サイクル開始から7.6秒)`, '#f39c12');
                    console.log(`機能${timerId}: サイクルから7.6秒後に音が鳴りました。`);
                    timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());
                }, 7.6 * 1000);

                const cycleTimeout2 = setTimeout(() => {
                    playBeep();
                    updateStatus(timer.statusElement, `音2鳴動 (サイクル開始から12.6秒)`, '#f39c12');
                    console.log(`機能${timerId}: サイクルから12.6秒後に音が鳴りました。`);
                    timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());
                }, 12.6 * 1000);
                timer.timeouts.push(cycleTimeout1, cycleTimeout2);
            };

            const initialTimeout1 = setTimeout(() => {
                playBeep();
                updateStatus(timer.statusElement, '105秒経過！', '#3498db');
                console.log(`機能${timerId}: 105秒後に音が鳴りました。`);
                timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());
            }, 105 * 1000);

            const initialTimeout2 = setTimeout(() => {
                playBeep();
                updateStatus(timer.statusElement, '110秒経過！繰り返し開始。', '#3498db');
                console.log(`機能${timerId}: 110秒後に音が鳴りました。初回完了。`);
                timer.nextBeepTimes = timer.nextBeepTimes.filter(t => t > Date.now());

                playCycleBeeps();

                const intervalId = setInterval(() => {
                    playCycleBeeps();
                }, 12.6 * 1000);
                timer.intervals.push(intervalId);

            }, 110 * 1000);

            timer.timeouts.push(initialTimeout1, initialTimeout2);

            timer.updateInterval = setInterval(() => {
                const nextBeep = timer.nextBeepTimes[0];
                updateNextBeepTime(timer.nextBeepElement, nextBeep || '');
            }, 1000);
        }

        // ページロード時に全てのタイマーの表示を初期化
        document.addEventListener('DOMContentLoaded', () => {
            // ID 1から4 (機能1) と ID 6, 7 (機能2, 3) を初期化
            const timerIdsToInit = [1, 2, 3, 4, 6, 7];
            timerIdsToInit.forEach(i => {
                const section = document.getElementById(`timerSection${i}`);
                if (section) {
                    timers[i].statusElement = section.querySelector('.current-status');
                    timers[i].nextBeepElement = section.querySelector('.next-beep-time');
                    timers[i].sectionElement = section;
                    resetTimer(i);
                }
            });
        });
    </script>
</body>
</html>